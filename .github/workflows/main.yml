name: CI
on: [push]

jobs:
  sast_scan:
    name: Run bandit scan
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v6.0.2
    - name: setup python
      uses: actions/setup-python@v6.2.0
      with:
        python-version: 3.12
    - name: Install bandit
      run: pip install bandit
    - name: run bandit scan
      run: bandit -ll -ii -r . -f json -o bandit-report.json
    - name: downloading artifact
      uses: actions/upload-artifact@v6.0.0
      if: always()
      with:
        path: bandit-report.json
        name: bandit-report
  image_scan:
    name: Build image and run image scan
    runs-on: ubuntu-latest

    steps:
      - name: checkout code
        uses: actions/checkout@v6.0.2

      - name: setup docker
        uses: docker/setup-docker-action@v4.7.0
      - name: build docker image
        run: docker build -f Dockerfile -t myapp:latest .
      - name: docker scout scan
        run: |
          curl -fsSL https://raw.githubusercontent.com/docker/scout-cli/main/install.sh -o install-scout.sh
          sh install-scout.sh
          docker scout quickview
          docker scout cves
          
      
  
      
